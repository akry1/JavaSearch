Next, let's take a look at applying an adaptor to our design. Adaptors are used to add functionality to the event handling process that:<br /><br />is general to the process and not specific to any one listener; or<br />is not supposed to affect the implementation of specific listeners.<br /><br />According to the Event Model specification a typical use case for an adaptor is to add routing logic for events. But you can also add filtering or logging. In our case, let's do that: add logging of the numbers as "proof" for the calculations done in the listeners.<br />An adaptor, as explained earlier, is a class that sits between the event source and the listeners. From the point of view of the event source, it masquerades as a listener (so it must implement the listener interface). From the point of view of the listeners it pretends to be the event source (so it should have add and remove methods). In other words, to write an adaptor you have to repeat some code from the event source (to manage listeners) and you have to re-implement the event notification methods to do some extra stuff and then pass the event on to the actual listeners.<br />In our case we need an adaptor that writes the numbers to a log file. Keeping it simple once again, let's settle for an adaptor that:<br /><br />Uses a fixed log file name and overwrites that log file with every program run.<br />Opens a FileWriter in the constructor and just keeps it open.<br />Implements the numberRead method by writing the number to the FileWriter.<br />Implements the numberStreamTerminated method by closing the FileWriter.<br /><br />Also, we can make life easy on ourselves by just copying all the code we need to manage listeners over from the NumberReader class. Again, in a real program you'd want to do this differently. Note that each notification method implementation also passes the event on to all the real listeners:<br /><br /><br /><br />Code listing 1.6: NumberReaderLoggingAdaptor.<br /><br /><br />package org.wikibooks.en.javaprogramming.example;<br /><br />import java.io.BufferedWriter;<br />import java.io.FileWriter;<br />import java.io.IOException;<br />import java.util.HashSet;<br />import java.util.Set;<br /><br />public class NumberReaderLoggingAdaptor implements NumberReadListener {<br />    private Set<NumberReadListener> listeners;<br />    private BufferedWriter output;<br />   <br />    public NumberReaderLoggingAdaptor() {<br />        listeners = new HashSet<NumberReadListener>();<br />        try {<br />            output = new BufferedWriter(new FileWriter("numberLog.log"));<br />        } catch (IOException e) {<br />            // TODO Auto-generated catch block<br />            e.printStackTrace();<br />        }<br />    }<br />   <br />    public void addNumberReadListener(NumberReadListener listener) {<br />        this.listeners.add(listener);<br />    }<br />   <br />    public void removeNumberReadListener(NumberReadListener listener) {<br />        this.listeners.remove(listener);<br />    }<br />   <br />   <br />    @Override<br />    public void numberRead(NumberReadEvent numberReadEvent) {<br />        try {<br />            output.write(numberReadEvent.getNumber() + "\n");<br />        } catch (Exception e) {<br />           <br />        }<br />        for (NumberReadListener numberReadListener: listeners) {<br />            numberReadListener.numberRead(numberReadEvent);<br />        }<br />    }<br /><br />    @Override<br />    public void numberStreamTerminated(NumberReadEvent numberReadEvent) {<br />        try {<br />            output.flush();<br />            output.close();<br />        } catch (Exception e) {<br />           <br />        }<br />        for (NumberReadListener numberReadListener: listeners) {<br />            numberReadListener.numberStreamTerminated(numberReadEvent);<br />        }<br />    }<br /><br />}<br /><br /><br /><br /><br />Of course, to make the adaptor work we have to make some changes to the bootstrap code:<br /><br /><br /><br />Code listing 1.7: Main.<br /><br /><br />package org.wikibooks.en.javaprogramming.example;<br /><br />public class Main {<br /><br />    public static void main(String[] args) {<br />        NumberReader reader = new NumberReader();<br />        NumberReadListener listener = new NumberReadListenerImpl();<br />        NumberReaderLoggingAdaptor adaptor = new NumberReaderLoggingAdaptor();<br />        adaptor.addNumberReadListener(listener);<br />        reader.addNumberReadListener(adaptor);<br />        reader.start();<br />    }<br />}<br /><br /><br /><br /><br />But note how nicely and easily we can re-link the objects in our system. The fact that adaptors and listeners both implement the listener interface and the adaptor and event source both look like event sources means that we can hook the adaptor into the system without having to change a single statement in the classes that we developed earlier.<br />And of course, if we run the same example as given above, the numbers are now recorded in a log file.